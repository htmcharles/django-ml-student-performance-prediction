<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Performance Prediction</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'performance/css/style.css' %}">
</head>

<body>
    <div class="container">
        <h1>Predictor</h1>
        <p class="subtitle">AI-powered student performance insights</p>

        {% if error %}
        <div class="alert alert-error">
            <strong>{{ error }}</strong>
            <ul>
                {% for field, messages in details.items %}
                <li>{{ field|title }}: {{ messages|join:", " }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if prediction %}
        <div class="alert alert-success">
            <p>Predicted Performance Index</p>
            <h2>{{ prediction }}</h2>
        </div>
        {% endif %}

        <div id="consumption-indicator" class="consumption-indicator">
            Time Consumed: <b id="total-hours">0</b>h / 24h
        </div>

        <form method="post" id="predict-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="hours_studied">Hours Studied</label>
                <input type="number" id="hours_studied" name="hours_studied" value="{{ data.hours_studied|default:'' }}"
                    placeholder="e.g. 5" required>
            </div>

            <div class="form-group">
                <label for="previous_scores">Previous Scores</label>
                <input type="number" id="previous_scores" name="previous_scores"
                    value="{{ data.previous_scores|default:'' }}" placeholder="e.g. 85" required>
            </div>

            <div class="form-group">
                <label for="extracurricular">Extracurricular Activities</label>
                <select id="extracurricular" name="extracurricular">
                    <option value="true" {% if data.extracurricular %}selected{% endif %}>Yes</option>
                    <option value="false" {% if not data.extracurricular %}selected{% endif %}>No</option>
                </select>

            </div>

            <div class="form-group">
                <label for="sleep_hours">Sleep Hours</label>
                <input type="number" id="sleep_hours" name="sleep_hours" value="{{ data.sleep_hours|default:'' }}"
                    placeholder="e.g. 8" required>
            </div>

            <div class="form-group">
                <label for="sample_papers">Sample Papers Practiced</label>
                <input type="number" id="sample_papers" name="sample_papers" value="{{ data.sample_papers|default:'' }}"
                    placeholder="e.g. 3" required>
            </div>

            <button type="submit" id="submit-btn">Predict Performance</button>
        </form>
    </div>

    <script>
        const hoursStudied = document.getElementById('hours_studied');
        const sleepHours = document.getElementById('sleep_hours');
        const totalHoursDisplay = document.getElementById('total-hours');
        const indicator = document.getElementById('consumption-indicator');
        const submitBtn = document.getElementById('submit-btn');

        function updateConsumption() {
            const total = (parseInt(hoursStudied.value) || 0) + (parseInt(sleepHours.value) || 0);
            totalHoursDisplay.textContent = total;

            if (total > 24) {
                indicator.classList.add('paradox');
                hoursStudied.classList.add('paradox-input');
                sleepHours.classList.add('paradox-input');
                submitBtn.textContent = '‚ùå TIME PARADOX DETECTED';
                submitBtn.style.background = 'var(--error-text)';
            } else {
                indicator.classList.remove('paradox');
                hoursStudied.classList.remove('paradox-input');
                sleepHours.classList.remove('paradox-input');
                submitBtn.textContent = 'Predict Performance';
                submitBtn.style.background = 'var(--primary)';
            }
        }

        hoursStudied.addEventListener('input', updateConsumption);
        sleepHours.addEventListener('input', updateConsumption);
        updateConsumption();
    </script>
</body>

</html>